# 多级反馈队列 (MLFQ) 调度模拟器

这是一个基于 JavaFX 开发的简易多级反馈队列 (MLFQ) CPU 调度算法模拟器。它旨在帮助用户直观地理解 MLFQ 调度的工作原理，并分析不同进程组合下的系统性能指标。

## 功能特性

* **多级反馈队列模拟：** 实现了三级队列：
  * **队列 1 (Q1):** 最高优先级，采用时间片轮转 (Round Robin, RR) 调度，时间片为 5ms。
  * **队列** 2 **(Q2):** 中优先级，采用时间片轮转 (Round Robin, RR) 调度，时间片为 10ms。
  * **队列 3 (Q3):** 最低优先级，采用先来先服务 (First-Come, First-Served, FCFS) 调度。
* **进程管理：**
  * 支持添加自定义到达时间 (Arrival Time) 和突发时间 (Burst Time) 的进程。
  * 显示已添加进程列表。
* **模拟模式：**
  * **自动模式：** 自动推进模拟时间，实时显示调度过程和状态更新。
  * **手动模式：** 支持单步执行和通过时间滑块跳跃到特定时间点。
* **实时状态显示：**
  * 显示当前模拟时间。
  * 显示当前正在执行的进程。
  * 显示各队列 (Q1, Q2, Q3) 的实时状态和排队进程。
  * 显示已完成进程列表。
* **性能指标计算：**
  * 平均等待时间 (Average Waiting Time)。
  * 系统吞吐量 (Throughput)。
  * 平均响应时间 (Average Response Time)。
  * CPU 利用率 (CPU Utilization)。
* **模拟历史记录：**
  * 保存每次模拟的结果（进程数据和性能指标）。
  * 可加载历史记录，复现模拟或应用历史进程数据。
  * 支持清空历史记录。
* **实时日志：** 详细记录模拟过程中关键事件（如进程到达、调度、完成、降级等）。
* **甘特图可视化 (Gantt Chart Visualization)：** 在自动模式下启动模拟时，将弹出一个新窗口，以甘特图形式直观地展示 CPU 在各个时间段执行不同进程的情况。

## 项目结构

本项目遵循 MVC（模型-视图-控制器）的设计思想，并对核心逻辑进行了模块化拆分，以提高代码的可维护性和可读性。

```
mlfq/
├── pom.xml                     # Maven 项目配置文件
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── mlfq/
│   │   │           └── mlfq/
│   │   │               ├── MlfqSimulatorApp.java       # 应用程序主入口，负责启动JavaFX应用
│   │   │               ├── MlfqSimulatorController.java  # 主界面控制器，处理用户交互和UI更新
│   │   │               ├── MlfqScheduler.java          # MLFQ调度核心逻辑的封装
│   │   │               ├── SimulationDataManager.java    # 模拟历史记录的保存和加载管理
│   │   │               ├── Process.java                  # 进程数据模型
│   │   │               ├── ExecutionSegment.java         # 甘特图时间段数据模型
│   │   │               └── GanttChartController.java     # 甘特图窗口的控制器，负责绘制图表
│   │   └── resources/
│   │       └── com/
│   │           └── mlfq/
│   │               └── mlfq/
│   │                   ├── mlfq-simulator-view.fxml    # 主界面的FXML布局文件
│   │                   └── gantt-chart-view.fxml       # 甘特图窗口的FXML布局文件
│   └── test/
│       └── ...                 # 测试文件 (如果存在)
└── target/                     # 构建输出目录
    └── classes/
        └── com/
            └── mlfq/
                └── mlfq/
                    └── mlfq_sim_history.txt    # 模拟历史数据文件 (运行时自动生成)
```

## 环境要求

* Java Development Kit (JDK) 11 或更高版本 (本项目使用 Java 21)
* JavaFX SDK (通常集成在现代 JDK 中，如果使用模块化项目，可能需要单独配置)
* Maven 或 Gradle (推荐用于项目管理和依赖管理)
* 任何支持 JavaFX 开发的集成开发环境 (IDE)，如 IntelliJ IDEA, Eclipse。

## 设置与运行

以下是在 IntelliJ IDEA 中设置和运行项目的步骤：

1. **克隆或下载项目：** 将项目文件下载到您的本地机器。

2. **在 IDE 中打开项目：**
   * 打开 IntelliJ IDEA。
   * 选择 `File` -> `Open`，然后导航到您下载的项目根目录并打开 `pom.xml` (如果是 Maven 项目)。
   * IntelliJ IDEA 会自动检测 Maven 项目并导入依赖。

3. **配置 JavaFX (如果需要)：**
   * 对于 Maven 项目，JavaFX 依赖通常在 `pom.xml` 中配置好。如果遇到 JavaFX 相关的错误（例如 `javafx.graphics` 模块找不到），您可能需要检查您的 Maven 配置或手动添加 JavaFX SDK 到您的模块路径。

4. **清理并重建项目：**
   * 在 IDE 菜单中，选择 `Build` -> `Clean Project`。
   * 然后选择 `Build` -> `Rebuild Project`。这能确保所有文件，特别是 FXML 和资源文件，被正确编译和打包。

5. **运行应用程序：**
   * 找到 `src/main/java/com/mlfq/mlfq/MlfqSimulatorApp.java` 文件。
   * 右键点击 `MlfqSimulatorApp.java` 文件，选择 `Run 'MlfqSimulatorApp.main()'`。

应用程序的主界面应该会弹出。

## 使用说明

1. **添加进程：**
   * 在“到达时间 (ms)”和“突发时间 (ms)”文本框中输入以逗号分隔的整数值。例如：
     * 到达时间：`0,5,10`
     * 突发时间：`20,30,15`
   * 点击“添加进程”按钮。已添加的进程将显示在右侧的列表中。

2. **切换模式：**
   * 点击“切换到手动模式”/“切换到自动模式”按钮来切换模拟器的运行方式。

3. **开始模拟 (自动模式)：**
   * 确保是“自动模式”。
   * 点击“开始模拟”按钮。模拟将自动运行，并在新窗口中显示甘特图。您可以点击“暂停模拟”来暂停，再次点击“继续模拟”来恢复。

4. **单步执行 (手动模式)：**
   * 确保是“手动模式”。
   * 点击“单步执行”按钮，模拟将每次推进一个时间单位。
   * 您也可以拖动“模拟时间轴”滑块来快速跳跃到特定时间点。

5. **重置模拟：**
   * 点击“重置模拟”按钮，将清空当前模拟状态并关闭甘特图窗口。

6. **查看历史记录：**
   * 左侧的“模拟历史记录”列表会显示之前完成的模拟。
   * 点击列表中的任意历史记录条目，将弹出一个模态框，显示该次模拟的进程数据和性能指标。
   * 在模态框中，您可以选择“应用模拟”来加载该历史记录的进程数据到主界面，或点击“返回”关闭模态框。
   * 点击“清空历史”按钮可以清除所有历史记录。
